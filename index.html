<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador Marte</title>
  <style>
    body {
      background-color: #5b2c1c;
      font-family: sans-serif;
      color: white;
    }
    #controls {
      margin-bottom: 10px;
    }
    button {
      margin-right: 5px;
      padding: 8px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(100, 20px);
      grid-template-rows: repeat(100, 20px);
      gap: 1px;
    }
    .cell {
      width: 20px;
      height: 20px;
      background-color: #a0522d;
      border: 1px solid transparent;
      text-align: center;
      font-size: 16px;
      line-height: 20px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="setMode('road')">Agregar carretera</button>
    <button onclick="setMode('remove')">Quitar carretera</button>
    <button onclick="resetRoads()">Reiniciar carreteras</button>
    <button onclick="addCar()">Agregar coche</button>
    <span id="money">Dinero: $100000</span>
  </div>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const moneyEl = document.getElementById("money");
    const roadTexture = "url('https://github.com/DiegoGO2002/sttretcar/blob/main/ChatGPT%20Image%2023%20jul%202025,%2012_55_53%20p.m..png?raw=true')";
    const cells = [];
    let mode = 'road';
    let money = 100000;
    let isMouseDown = false;
    const start = [0, 0];
    const end = [99, 99];
    const cars = [];

    function setMode(newMode) {
      mode = newMode;
    }

    function updateMoney(amount) {
      money += amount;
      moneyEl.textContent = `Dinero: $${money}`;
    }

    function resetRoads() {
      for (let row of cells) {
        for (let cell of row) {
          cell.dataset.road = "false";
          cell.style.backgroundImage = "";
        }
      }
    }

    function createGrid() {
      for (let y = 0; y < 100; y++) {
        const row = [];
        for (let x = 0; x < 100; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.x = x;
          cell.dataset.y = y;
          cell.dataset.road = "false";
          grid.appendChild(cell);
          row.push(cell);

          cell.addEventListener("mousedown", () => {
            isMouseDown = true;
            handleCellClick(cell);
          });
          cell.addEventListener("mouseenter", () => {
            if (isMouseDown) handleCellClick(cell);
          });
        }
        cells.push(row);
      }

      document.addEventListener("mouseup", () => {
        isMouseDown = false;
      });

      // Banderitas
      cells[start[1]][start[0]].textContent = "ðŸ";
      cells[end[1]][end[0]].textContent = "ðŸ";
    }

    function handleCellClick(cell) {
      const x = +cell.dataset.x;
      const y = +cell.dataset.y;
      if ((x === start[0] && y === start[1]) || (x === end[0] && y === end[1])) return;

      if (mode === 'road' && money >= 10) {
        if (cell.dataset.road === "false") {
          cell.dataset.road = "true";
          cell.style.backgroundImage = roadTexture;
          cell.style.backgroundSize = "cover";
          updateMoney(-10);
        }
      } else if (mode === 'remove') {
        cell.dataset.road = "false";
        cell.style.backgroundImage = "";
      }
    }

    function addCar() {
      const path = findPath(start, end);
      if (!path || path.length === 0) {
        alert("No hay camino disponible");
        return;
      }

      const car = {
        element: document.createElement("div"),
        path,
        position: 0,
        crashed: false
      };
      car.element.className = "cell";
      car.element.textContent = "ðŸš—";
      car.element.style.position = "absolute";
      grid.appendChild(car.element);
      cars.push(car);
    }

    function updateCars() {
      for (let car of cars) {
        if (car.crashed || car.position >= car.path.length) continue;

        const [x, y] = car.path[car.position];
        const cell = cells[y][x];

        // Check collision
        for (let other of cars) {
          if (other !== car && !other.crashed && other.path[other.position]?.[0] === x && other.path[other.position]?.[1] === y) {
            car.element.textContent = "ðŸš—";
            car.element.style.color = "red";
            other.element.textContent = "ðŸš—";
            other.element.style.color = "red";
            car.crashed = true;
            other.crashed = true;
            return;
          }
        }

        // Move car to cell
        cell.appendChild(car.element);
        car.position++;
      }
    }

    function findPath(start, end) {
      const queue = [[start]];
      const visited = new Set();
      visited.add(start.toString());

      while (queue.length > 0) {
        const path = queue.shift();
        const [x, y] = path[path.length - 1];

        if (x === end[0] && y === end[1]) return path;

        const neighbors = [
          [x + 1, y],
          [x - 1, y],
          [x, y + 1],
          [x, y - 1]
        ];

        for (let [nx, ny] of neighbors) {
          if (
            nx >= 0 && ny >= 0 && nx < 100 && ny < 100 &&
            cells[ny][nx].dataset.road === "true" &&
            !visited.has([nx, ny].toString())
          ) {
            visited.add([nx, ny].toString());
            queue.push([...path, [nx, ny]]);
          }
        }
      }
      return null;
    }

    createGrid();
    setInterval(updateCars, 200);
  </script>
</body>
</html>
